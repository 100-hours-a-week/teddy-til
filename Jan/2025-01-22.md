# TIL Template

## ë‚ ì§œ: 2025-01-21

### ğŸ””ìŠ¤í¬ëŸ¼
- HTTP ë³´ì•ˆ í—¤ë” ê²€í†  ì§„í–‰(2ì£¼ì°¨ ê³¼ì œ)
- 3ì£¼ì°¨ ê³¼ì œ ì§„í–‰
- ì½”í…Œ 1ë¬¸ì œ í’€ê¸°
- TIL ì‘ì„±

### ğŸ“–Today I Learned
## ë¬´ì¤‘ë‹¨ ë°°í¬

**ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ì´** ìƒˆë¡œìš´ ë²„ì „ì˜ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë°°í¬í•˜ëŠ” ê¸°ìˆ 

## ë¡¤ë§(Rolling) ë°°í¬

**ì •í•´ì§„ ë¹„ìœ¨ë§Œí¼**ì˜ íŒŒë“œë§Œ **ì ì§„ì ìœ¼ë¡œ ë°°í¬**

- **ë°©ì‹1**
    - ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ ì¶”ê°€í•˜ê³ , ìƒˆë¡œìš´ ë²„ì „ì„ ì‹¤í–‰. ë¡œë“œ ë°¸ëŸ°ì„œì— ì´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì—°ê²° í›„ ê¸°ì¡´ êµ¬ë²„ì „ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ë¥¼ ì¤„ì„.
    - ì„œë²„ ê°œìˆ˜ë¥¼ ìœ ì—°í•˜ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆëŠ” AWSì™€ ê°™ì€ **í´ë¼ìš°ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•  ë•Œ ì í•©í•œ ë°©ì‹**ì¼ ê²ƒ ê°™ìŒ

![rolling-deployment-2-f9d7e1eae7c7a5be1629fd5dda3c011b.gif](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/98a39bc6-4567-43fb-a404-db0225000929/rolling-deployment-2-f9d7e1eae7c7a5be1629fd5dda3c011b.gif)

- **ë°©ì‹2**
    - V1ì´ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì„œë²„ í•˜ë‚˜ë¥¼ ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ë–¼ì–´ëƒ„
    - í•´ë‹¹ ì„œë²„ì—ëŠ” íŠ¸ë˜í”½ì´ ë„ë‹¬í•˜ì§€ ì•Šê²Œ ë¨. ì´ ìƒíƒœì—ì„œ í•´ë‹¹ ì„œë²„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ V2ë¡œ êµì²´. ì´ ê³¼ì •ì„ ë°˜ë³µí•´ì„œ ëª¨ë“  ì„œë²„ë¥¼ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ êµì²´
    - ì´ëŸ° ë°©ì‹ì€ í´ë¼ìš°ë“œ í™˜ê²½ì´ ì•„ë‹Œ, **ë¬¼ë¦¬ì ì¸ ì„œë²„ë¡œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ëŠ” ìƒí™©ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì„**

![rolling-deployment-bf6f561cf6dd6e9fe9cbc45530dcadb2.gif](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/00496371-78c1-4e4b-83ca-a5f1e7d252d7/rolling-deployment-bf6f561cf6dd6e9fe9cbc45530dcadb2.gif)

### ì¥ì 

- ì¸ìŠ¤í„´ìŠ¤ê°€ ì°¨ë¡€ë¡œ ë°°í¬ë˜ì–´ **ì†ì‰½ê²Œ ë¡¤ë°± ê°€ëŠ¥**
- **ë§ì€ ì„œë²„ ìì›ì„ í™•ë³´í•˜ì§€ ì•Šì•„ë„** ë¬´ì¤‘ë‹¨ ë°°í¬ ê°€ëŠ¥
- ê´€ë¦¬ê°€ **ê°„í¸í•¨**

### ë‹¨ì 

- ìƒˆ ë²„ì „ì„ ë°°í¬í•  ë•Œ ì¸ìŠ¤í„´ìŠ¤ì˜ ìˆ˜ê°€ ê°ì†Œí•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ì— **íŠ¸ë˜í”½ì´ ëª°ë¦´ ìˆ˜ ìˆìŒ**
- ë°°í¬ê°€ ì§„í–‰ë  ë•Œ êµ¬ë²„ì „ê³¼ ì‹ ë²„ì „ì´ ê³µì¡´í•˜ì—¬ **í˜¸í™˜ì„± ë¬¸ì œ**ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ

### k8sì—ì„œì˜ Rolling Update

1. ReflicaSetì´ v1 ë²„ì „ì˜ 3ê°œì˜ íŒŒë“œë¥¼ ê´€ë¦¬í•˜ê³  ìˆëŠ” ìƒíƒœ
2. v2 ë²„ì „ì˜ pod 3ê°œë¥¼ ë°°í¬í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ìƒê¹€. v2 íŒŒë“œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” RefilcaSetì„ ë§Œë“¤ê³  replicaì˜ ìˆ˜ë¥¼ 1ë¡œ ì„¤ì •í•´ì„œ v2 íŒŒë“œë¥¼ í•˜ë‚˜ ìƒì„±. ReflicaSet v1ì€ replicaì˜ ìˆ˜ë¥¼ 3 â†’ 2ë¡œ ì¤„ì´ê³  v1 íŒŒë“œì˜ ìˆ˜ë¥¼ 2ê°œë¡œ ì¡°ì •
3. v1ì˜ íŒŒë“œëŠ” ìˆ˜ë¥¼ ì¤„ì—¬ê°€ê³  v2 íŒŒë“œëŠ” ìˆ˜ë¥¼ ëŠ˜ë ¤ê°. ìµœì¢…ì ìœ¼ë¡œ v1ì˜ íŒŒë“œëŠ” 0ê°œê°€ ë˜ê³  ReflicaSet v1ì€ ì‚­ì œë¨.

!https://blog.kakaocdn.net/dn/Rablv/btqFKCMzjIB/yrXxS13TlM2zI0Kkj3Zqi0/img.gif

---

## ë¸”ë£¨-ê·¸ë¦°(Blue-Green) ë°°í¬

**êµ¬ë²„ì „ê³¼ ì‹ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ êµ¬ì„±**í•œ í›„ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•´ ëª¨ë“  íŠ¸**ë˜í”½ì„ í•œ ë²ˆì— ì‹ ë²„ì „ìœ¼ë¡œ ì „í™˜**í•˜ëŠ” ë°©ì‹. **í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™˜ê²½ì„ ë¸”ë£¨**, **ì‹ ë²„ì „ì„ ê·¸ë¦°**ì´ë¼ê³  ë¶€ë¦„

!https://blog.kakaocdn.net/dn/bSE9Ux/btsDJTIxqTD/dy2FdLyNkB4kzuE49sVyX0/img.gif

### ì¥ì 

- êµ¬ë²„ì „ê³¼ ë™ì¼í•œ ìš´ì˜ í™˜ê²½ì— ì‹ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë“¤ì„ ì˜¬ë¦¬ê¸° ë•Œë¬¸ì— ì‹¤ì œ ì„œë¹„ìŠ¤ ë°°í¬ í™˜ê²½ì—ì„œ **ì‹ ë²„ì „ì„ ë¯¸ë¦¬ í…ŒìŠ¤íŠ¸** í•´ë³¼ ìˆ˜ ìˆìŒ
- êµ¬ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ê·¸ëŒ€ë¡œ **ë‚¨ì•„ìˆì–´ì„œ ë¡¤ë°±ì´ ì‰¬ì›€**
- êµ¬ë²„ì „ì„ ë‹¤ìŒ ë°°í¬ì— **ì¬ì‚¬ìš©**í•  ìˆ˜ ìˆìŒ

### ë‹¨ì 

- ì‹œìŠ¤í…œ ìì›ì´ **ë‘ ë°°ë¡œ í•„ìš”í•¨**

### k8sì—ì„œì˜ ë¸”ë£¨-ê·¸ë¦° ë°°í¬

**ë””í”Œë¡œì´ë¨¼íŠ¸ ìƒì„±**

1. minikube ì„¤ì¹˜

```bash
brew install minikube
```

1. minikube ì‹œì‘

```bash
minikube start
```

ì´ëŸ° ë¬¸êµ¬ê°€ ëœ¬ë‹¤ë©´ docker ì‹¤í–‰í•˜ê³  ë‹¤ì‹œ ëª…ë ¹ì–´ ì‹¤í–‰!

```bash
ğŸ˜„  Darwin 14.3 (arm64) ì˜ minikube v1.35.0
ğŸ‘  Unable to pick a default driver. Here is what was considered, in preference order:
    â–ª docker: Not healthy: "docker version --format {{.Server.Os}}-{{.Server.Version}}:{{.Server.Platform.Name}}" exit status 1: Cannot connect to the Docker daemon at unix:///Users/hwang-inchan/.docker/run/docker.sock. Is the docker daemon running?
    â–ª docker: Suggestion: Start the Docker service <https://minikube.sigs.k8s.io/docs/drivers/docker/>
ğŸ’¡  ë˜ëŠ” ë‹¤ìŒ ë“œë¼ì´ë²„ ì¤‘ í•˜ë‚˜ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
    â–ª hyperkit: Not installed: exec: "hyperkit": executable file not found in $PATH
    â–ª parallels: Not installed: exec: "prlctl": executable file not found in $PATH
    â–ª qemu2: Not installed: exec: "qemu-system-aarch64": executable file not found in $PATH
    â–ª virtualbox: Not installed: unable to find VBoxManage in $PATH
    â–ª vfkit: Not installed: exec: "vfkit": executable file not found in $PATH
    â–ª podman: Not installed: exec: "podman": executable file not found in $PATH

âŒ  Exiting due to DRV_DOCKER_NOT_RUNNING: ë„ì»¤ë¥¼ ì°¾ì•˜ìœ¼ë‚˜ docker service ê°€ ì‹¤í–‰ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤, docker service ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”
```

1. Deployment ìƒì„±
    - nginx v1.11 ìƒì„±
    
    ```bash
    vi nginx11.yaml
    ```
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: deploy-nginx11
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: deploy-nginx11
      template:
        metadata:
          labels:
            app: deploy-nginx11
        spec:
          containers:
          - name: deploy-nginx11
            image: nginx:1.11
    ```
    
    ```bash
    kubectl apply -f nginx11.yaml
    ```
    
    - nginx v1.12 ìƒì„±
    
    ```bash
    vi nginx12.yaml
    ```
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: deploy-nginx12
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: deploy-nginx12
      template:
        metadata:
          labels:
            app: deploy-nginx12
        spec:
          containers:
          - name: deploy-nginx12
            image: nginx:1.12
    ```
    
    ```bash
    kubectl apply -f nginx12.yaml
    ```
    
    - nginx v1.11ì˜ index.html ë‚´ìš© ë³€ê²½
    
    ```bash
    for pod in $(kubectl get pod -l app=deploy-nginx11 |awk 'NR>1 {print $1}'); do kubectl exec $pod -- /bin/sh -c "hostname > /usr/share/nginx/html/index.html; echo 'nginx:v1.11 END' >> /usr/share/nginx/html/index.html"; done
    ```
    
    - nginx v1.12ì˜ index.html ë‚´ìš© ë³€ê²½
    
    ```bash
    for pod in $(kubectl get pod -l app=deploy-nginx12 |awk 'NR>1 {print $1}'); do kubectl exec $pod -- /bin/sh -c "hostname > /usr/share/nginx/html/index.html; echo 'nginx:v1.12 END' >> /usr/share/nginx/html/index.html"; done
    ```
    

â†’ curlì„ í†µí•´ ì ‘ì† ì‹œ **íŒŒë“œ ì´ë¦„ ë° ë²„ì „, ê·¸ë¦¬ê³  END í‘œì‹œ**ê°€ ë˜ë„ë¡ ìˆ˜ì •

nginx v1.11 / nginx v1.12 ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
kubectl get pod -o wide
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/15eeddda-ba7b-43c7-b53c-2fccedc344b4/image.png)

```bash
minikube ssh
```

â†’ minikube ì‚¬ìš©ì‹œ ì™¸ë¶€ì—ì„œ curlì„ í†µí•´ pod ì ‘ì†ì´ ì•ˆë˜ì–´ minikubeì˜ VMì— ì§ì ‘ ì ‘ì†í•´ì„œ curl ì‹œë„

- nginx v1.11 Pod IPì— ì ‘ì† ì‹œë„ deploy-nginx11ì— í•´ë‹¹í•˜ëŠ” IP ì¤‘ í•˜ë‚˜ ì„ íƒ

```bash
docker@minikube:~$ curl -s "deploy-nginx11ì— í•´ë‹¹í•˜ëŠ” IP ì¤‘ í•˜ë‚˜ ì„ íƒ"
deploy-nginx11-6c77695498-7tcjf
nginx:v1.11 END
```

- nginx v1.12 Pod IPì— ì ‘ì† ì‹œë„

```bash
docker@minikube:~$ curl -s "deploy-nginx12ì— í•´ë‹¹í•˜ëŠ” IP ì¤‘ í•˜ë‚˜ ì„ íƒ"
deploy-nginx12-56b94dd8c4-9tcmq
nginx:v1.12 END
```

í™•ì¸ í›„

```bash
exit
```

**ì„œë¹„ìŠ¤ ìƒì„±**

- ClusterIp ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•´ nginx v1.11 íŒŒë“œë“¤ì˜ ì—”ë“œí¬ì¸íŠ¸ ì œê³µ

```bash
vi svc-nginx.yaml
```

```bash
apiVersion: v1
kind: Service
metadata:
  name: svc-nginx
spec:
  ports:
    - name: svc-nginx
      port: 9000
      targetPort: 80
  selector:
    app: deploy-nginx11
```

â†’ Typeì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ Typeì€ ClusterIP

```bash
kubectl apply -f svc-nginx.yaml
```

ì„œë¹„ìŠ¤ í™•ì¸

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get service svc-nginx
NAME        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
svc-nginx   ClusterIP   10.101.6.235   <none>        9000/TCP   14s
```

- í˜„ ìƒíƒœ

![blue-green-1.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/cd858bc7-760e-49d8-abe5-e9cdb789fe12/blue-green-1.png)

â†’ **ë”œë ˆì´ ì—†ì´** ë°”ë¡œ ì˜¤ë¥¸ìª½ ê·¸ë¦° ë°°í¬ë¡œ ì˜®ê²¨ì ¸ì•¼í•¨!

- ClusterIPì— ì—°ê²°ëœ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get endpoints svc-nginx
NAME        ENDPOINTS                                     AGE
svc-nginx   10.244.0.13:80,10.244.0.14:80,10.244.0.9:80   87s
```

â†’ íŒŒë“œë“¤ì˜ IPì™€ ë¹„êµ (ë™ì¼í•œ ê²ƒ í™•ì¸)

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get pod -owide -l app=deploy-nginx11 | awk 'NR>1 {print $8}'
10.244.0.13
10.244.0.9
10.244.0.14
```

- í„°ë¯¸ë„ í•˜ë‚˜ë¥¼ ë³„ë„ë¡œ ì—´ì–´ Blue ë°°í¬ì— ìˆëŠ” íŒŒë“œì˜ ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸

```bash
kubectl logs -l 'app in (deploy-nginx11)' -f --max-log-requests 8
```

- í„°ë¯¸ë„ì„ í•˜ë‚˜ ë” ì—´ì–´ì„œ Green ë°°í¬ì— ìˆëŠ” íŒŒë“œì˜ ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸

```bash
kubectl logs -l 'app in (deploy-nginx12)' -f --max-log-requests 8
```

- minikube bashì—ì„œ ClusterIPë¥¼ í†µí•´ curl -së¡œ ë°˜ë³µì ìœ¼ë¡œ ìš”ì²­ì„ ë³´ëƒ„

```bash
minikube bash
```

- ìš”ì²­ ë³´ë‚´ê¸°

```bash
SVC=10.101.6.235 # ClusterIP ì£¼ì†Œ
for i in {1..100}; do curl -s $SVC:9000 ; done | sort | uniq -c | sort -nr
while true; do curl -s --connect-timeout 1 $SVC:9000 ; echo "--------------" ; date "+%Y-%m-%d %H:%M:%S" ; sleep 1; done
```

```bash
2025-01-22 06:53:05
deploy-nginx11-6c77695498-k2m4k
nginx:v1.11 END
--------------
2025-01-22 06:53:06
deploy-nginx11-6c77695498-k2m4k
nginx:v1.11 END
--------------
2025-01-22 06:53:07
deploy-nginx11-6c77695498-k2m4k
nginx:v1.11 END
--------------
2025-01-22 06:53:08
deploy-nginx11-6c77695498-7tcjf
nginx:v1.11 END
--------------
2025-01-22 06:53:09
deploy-nginx11-6c77695498-7tcjf
nginx:v1.11 END
```

- Blue ë°°í¬ ë¡œê·¸

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/9a7fe7e8-902d-46b9-81a4-67e35fb7fdd9/image.png)

- Green ë°°í¬ ë¡œê·¸

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/979d1a36-b9a2-4367-9359-80f2b1332f9f/image.png)

**Green ë°°í¬ë¡œ ì „í™˜**

```bash
kubectl get svc svc-nginx -o yaml | sed -e "s/app: deploy-nginx11/app: deploy-nginx12/" | kubectl apply -f -
```

```bash
deploy-nginx12-56b94dd8c4-9tcmq
nginx:v1.12 END
--------------
2025-01-22 07:00:28
deploy-nginx12-56b94dd8c4-rcgnq
nginx:v1.12 END
--------------
2025-01-22 07:00:29
deploy-nginx12-56b94dd8c4-ztd56
nginx:v1.12 END
--------------
2025-01-22 07:00:30
deploy-nginx12-56b94dd8c4-9tcmq
nginx:v1.12 END
--------------
2025-01-22 07:00:31
deploy-nginx12-56b94dd8c4-rcgnq
nginx:v1.12 END
--------------
2025-01-22 07:00:32
deploy-nginx12-56b94dd8c4-ztd56
nginx:v1.12 END
--------------
2025-01-22 07:00:33
deploy-nginx12-56b94dd8c4-ztd56
nginx:v1.12 END
```

â†’ Green ë°°í¬ì˜ ë¡œê·¸ë§Œ ê¸°ë¡

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/bfd07baa-5dd4-491b-8206-1db8793ce43c/image.png)

- Blue ë²„ì „ìœ¼ë¡œ ë¡¤ë°±

```bash
kubectl get svc svc-nginx -o yaml | sed -e "s/app: deploy-nginx12/app: deploy-nginx11/" | kubectl apply -f -
```

**NodePortë¥¼ í†µí•œ ì›¹ì‚¬ì´íŠ¸ í™•ì¸**

ì›¹ìœ¼ë¡œ í™•ì¸í•˜ê¸° ìœ„í•´ NodePortë¥¼ í†µí•´ ì™¸ë¶€ë¡œ ë…¸ì¶œ

- svc-nginx ì„œë¹„ìŠ¤ì˜ ì¢…ë¥˜ë¥¼ NodePortë¡œ ë³€ê²½

```bash
kubectl edit svc svc-nginx
...
ports:
  - name: svc-nginx
    port: 9000
    protocol: TCP
    targetPort: 80
  selector:
    app: deploy-nginx11
  sessionAffinity: None
  type: ClusterIP # NodePortë¡œ ë³€ê²½
:wq

service/svc-nginx edited
```

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
kubernetes   ClusterIP   10.96.0.1      <none>        443/TCP          77m
svc-nginx    NodePort    10.101.6.235   <none>        9000:32428/TCP   35m
```

â†’ minikubeëŠ” ê°€ìƒë¨¸ì‹  ì•ˆì—ì„œ ëŒì•„ê°€ **ì™¸ë¶€ë¡œ ì ‘ì†ì´ ë¶ˆê°€,** minikube ìì²´ì—ì„œ ë…¸ì¶œì‹œì¼œì•¼í•¨

```bash
minikube service svc-nginx
|-----------|-----------|----------------|---------------------------|
| NAMESPACE |   NAME    |  TARGET PORT   |            URL            |
|-----------|-----------|----------------|---------------------------|
| default   | svc-nginx | svc-nginx/9000 | http://192.168.49.2:32428 |
|-----------|-----------|----------------|---------------------------|
ğŸƒ  svc-nginx ì„œë¹„ìŠ¤ì˜ í„°ë„ì„ ì‹œì‘í•˜ëŠ” ì¤‘
|-----------|-----------|-------------|------------------------|
| NAMESPACE |   NAME    | TARGET PORT |          URL           |
|-----------|-----------|-------------|------------------------|
| default   | svc-nginx |             | http://127.0.0.1:52250 |
|-----------|-----------|-------------|------------------------|
ğŸ‰  Opening service default/svc-nginx in default browser...
â—  darwin ì—ì„œ Docker ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, í„°ë¯¸ë„ì„ ì—´ì–´ì•¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
```

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/2caac6d4-1673-4905-8f0e-04f31ba30d30/image.png)

- Green ë°°í¬ë¡œ ì „í™˜

```bash
kubectl get svc svc-nginx -o yaml | sed -e "s/app: deploy-nginx11/app: deploy-nginx12/" | kubectl apply -f -
```

---

## ì¹´ë‚˜ë¦¬(Canary) ë°°í¬

ë°°í¬ë¥¼ í•  ë•Œ í…ŒìŠ¤íŠ¸í•  ìƒˆë¡œìš´ ë²„ì „(ì¹´ë‚˜ë¦¬)ë¥¼ ì¼ë¶€ ë°°í¬í•˜ê³ , ì„œë¹„ìŠ¤ê°€ ë¬¸ì œê°€ ì—†ëŠ”ì§€Â **í…ŒìŠ¤íŒ…ì„ ìˆ˜í–‰í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ì‹ ë²„ì „ì˜ ë¹„ì¤‘ì„ ëŠ˜ë ¤ê°€ëŠ” ë°©ì‹**

!https://blog.kakaocdn.net/dn/ztqpz/btsDHphbScN/S0Hr6KCVvExAz7oILAZN3K/img.gif

### k8sì—ì„œì˜ ì¹´ë‚˜ë¦¬ ë°°í¬

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/03d77a25-58bb-4d68-871e-317bd7efb34d/image.png)

1. DeployMent ìƒì„± (stable ë²„ì „)
    - mainui-stable.yaml
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mainui-stable
    spec:
      replicas: 2
      selector:
        matchLabels:
          app: mainui
          version: stable
      template:
        metadata:
          labels:
            app: mainui
            version: stable
        spec:
          containers:
          - name: mainui
            image: nginx:1.14
            ports:
            - containerPort: 80
    ```
    
    ```bash
    kubectl apply -f mainui-stable.yaml
    ```
    
2. íŒŒë“œê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get pods
NAME                             READY   STATUS    RESTARTS   AGE
mainui-stable-5dc74dfbcf-7lbqb   1/1     Running   0          62m
mainui-stable-5dc74dfbcf-jb87w   1/1     Running   0          62m
```

1. label í™•ì¸
    - `app=mainui`ë¡œ ë¬¶ì—¬ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get pods --show-labels
NAME                             READY   STATUS    RESTARTS   AGE   LABELS
mainui-stable-5dc74dfbcf-7lbqb   1/1     Running   0          65m   app=mainui,pod-template-hash=5dc74dfbcf,version=stable
mainui-stable-5dc74dfbcf-jb87w   1/1     Running   0          65m   app=mainui,pod-template-hash=5dc74dfbcf,version=stable
```

1. service ë‹¨ì¼ ì§„ì…ì  ìƒì„±
- mainui-service.yaml

```bash
apiVersion: v1
kind: Service
metadata:
  name: mainui-svc
spec:
  selector:
    app: mainui
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
```

```bash
kubectl apply -f mainui-service.yaml
```

1. ì„œë¹„ìŠ¤ í™•ì¸

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl get svc
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1        <none>        443/TCP   7h16m
mainui-svc   ClusterIP   10.102.121.195   <none>        80/TCP    50m
```

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl describe svc mainui-svc
Name:                     mainui-svc
Namespace:                default
Labels:                   <none>
Annotations:              <none>
Selector:                 app=mainui
Type:                     ClusterIP
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       10.102.121.195
IPs:                      10.102.121.195
Port:                     <unset>  80/TCP
TargetPort:               80/TCP
Endpoints:                10.244.0.20:80,10.244.0.21:80
Session Affinity:         None
Internal Traffic Policy:  Cluster
Events:                   <none>
```

1. ìš”ì²­ ë³´ë‚´ë³´ê¸°

```bash
minikube ssh
```

```bash
curl -s 10.102.121.195 # serviceì˜ clusterIP
```

```bash
docker@minikube:~$ curl -s 10.102.121.195
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```

â†’ nginxê°€ ì˜ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸! stable ë²„ì „ì´ë¯€ë¡œ nginx 1.14 verì´ ì‹¤í–‰ëì„ ê²ƒì„

```bash
exit
```

1. ìƒˆë¡œìš´ ë²„ì „ì˜ Deployment ìƒì„±
    - mainui-canary.yaml
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mainui-canary
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: mainui
          version: canary
      template:
        metadata:
          labels:
            app: mainui
            version: canary
        spec:
          containers:
          - name: mainui
            image: nginx:1.15
            ports:
            - containerPort: 80
    ```
    
    ```bash
    kubectl apply -f mainui-canary.yaml
    ```
    
2. service ì •ë³´ í™•ì¸

```bash
hwang-inchan@hwang-inchan-ui-MacBookPro ~ % kubectl describe svc mainui-svc
Name:                     mainui-svc
Namespace:                default
Labels:                   <none>
Annotations:              <none>
Selector:                 app=mainui
Type:                     ClusterIP
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       10.102.121.195
IPs:                      10.102.121.195
Port:                     <unset>  80/TCP
TargetPort:               80/TCP
Endpoints:                10.244.0.20:80,10.244.0.21:80,10.244.0.23:80 # canary ë²„ì „ì´ ì¶”ê°€ë˜ì—ˆìŒ
Session Affinity:         None
Internal Traffic Policy:  Cluster
Events:                   <none>
```

1. í„°ë¯¸ë„ 3ê°œ ì¶”ê°€ë¡œ ë„ì›Œì„œ ë¡œê·¸ í™•ì¸í•´ë³´ê¸°

```bash
kubectl logs -f "pod ì´ë¦„"
```

1. ìš”ì²­ ë³´ë‚´ê¸°

```bash
minikube ssh
```

```bash
curl -s 10.102.121.195 # serviceì˜ clusterIP
```

1. íŠ¸ë˜í”½ì´ë‚˜ ê°€ì¤‘ì¹˜ë¥¼ ì„¤ì •í•˜ì§€ ì•Šì•„ ëœë¤ìœ¼ë¡œ ìš”ì²­ì´ ë“¤ì–´ê°
    1. ë§¨ ì™¼ìª½, ê°€ìš´ë°ëŠ” stable
    2. ë§¨ ì˜¤ë¥¸ìª½ì€ canari

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/cf024025-486d-4514-84ae-3a7c5951c17c/5feb392b-c986-479b-a0de-0f44df0e7707/image.png)

â†’ íŠ¸ë˜í”½ ê´€ë¦¬ë¥¼ í•´ë³´ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ `Istio` ê³µë¶€ í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠ´ë‹¤.. ì „ Passâ€¦

---

## Probeì˜ ì¢…ë¥˜

**Probe**ëŠ” ì»¨í…Œì´ë„ˆì—ì„œ kubeletì— ì˜í•´ **ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ì§„ë‹¨**

**Probe**ë¥¼ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸ í›„ ì»¨í…Œì´ë„ˆë¥¼ ìë™ìœ¼ë¡œ **ì¬ì‹œì‘** í•˜ê±°ë‚˜ ë¬¸ì œê°€ ìˆëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì„œë¹„ìŠ¤ì—ì„œ **ì œì™¸**

### Liveness probe

- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ì²´í¬í•´ì„œ ì„œë²„ê°€ ì œëŒ€ë¡œ **ì‘ë‹µí•˜ëŠ”ì§€** í˜¹ì€ ì»¨í…Œì´ë„ˆê°€ ì œëŒ€ë¡œ **ë™ì‘ì¤‘**ì¸ì§€ ê²€ì‚¬
- Podì€ ì •ìƒì ì¸ **Running ìƒíƒœ**ì´ì§€ë§Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ë¬¸ì œê°€ ìƒê²¨**ì„œ ì ‘ì†ì´ ì•ˆë˜ëŠ” ê²½ìš°ë¥¼ ê°ì§€
- ë¬¸ì œë¥¼ ê°ì§€í•˜ë©´ **Podì„ ì£½ì´ê³  ì¬ì‹¤í–‰**í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¬¸ì œë¥¼ í•´ê²°
- Liveness ProbeëŠ” Podì˜Â `spec`Â ì„¹ì…˜ì— ì •ì˜ë˜ë©°,Â `initialDelaySeconds`,Â `periodSeconds`,Â `timeoutSeconds`,Â `failureThreshold`Â ë“±ì˜ ì˜µì…˜ì„ ì„¤ì •í•˜ì—¬ Probeì˜ ë™ì‘ì„ ì¡°ì •

```bash
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: my-container
      image: my-image
      livenessProbe:
        httpGet:
          path: /health
          port: 8080
        initialDelaySeconds: 10
        periodSeconds: 5
```

ìœ„ì˜ ì˜ˆì‹œëŠ”Â `/health`Â ì—”ë“œí¬ì¸íŠ¸ë¡œ HTTP GET ìš”ì²­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ë³´ë‚´ê³ , ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ëœ í›„ 10ì´ˆ ë’¤ë¶€í„° Probeê°€ ì‹œì‘. ProbeëŠ” 5ì´ˆë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©°, ì‘ë‹µì´ ì˜¤ëŠ”ì§€ í™•ì¸

### Readiness probe

- ì»¨í…Œì´ë„ˆê°€ **ìš”ì²­ì„ ì²˜ë¦¬í•  ì¤€ë¹„**ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸
- **Pod**ê°€ ìƒˆë¡œ ë°°í¬ë˜ê³  Running ìƒíƒœì—¬ë„ **ì²˜ìŒì— ë¡œë”©í•˜ëŠ” ì‹œê°„**ì´ ìˆê¸° ë•Œë¬¸ì— ì´ ì‹œê°„ ë™ì•ˆì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ì†í•˜ë ¤ê³  í•˜ë©´ **ì˜¤ë¥˜ê°€ ë°œìƒ**
- Readiness probeëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ êµ¬ë™ë˜ê¸° ì „ê¹Œì§€ ì„œë¹„ìŠ¤ì™€ ì—°ê²°ë˜ì§€ ì•Šê²Œ í•´ì¤Œ
- **Liveness Probe**ëŠ” probe í•¸ë“¤ëŸ¬ ì¡°ê±´ ì•„ë˜ **fail**ì´ ë‚˜ë©´ podë¥¼ **ì¬ì‹¤í–‰** **Readiness Probe**ëŠ” podë¥¼ ì„œë¹„ìŠ¤ë¡œë¶€í„° **ì œì™¸**
- Readiness Probeë„ Podì˜Â `spec`Â ì„¹ì…˜ì— ì •ì˜ë˜ë©°,Â `initialDelaySeconds`,Â `periodSeconds`,Â `timeoutSeconds`,Â `failureThreshold`Â ë“±ì˜ ì˜µì…˜ì„ ì„¤ì •í•˜ì—¬ Probeì˜ ë™ì‘ì„ ì¡°ì •í•  ìˆ˜ ìˆìŒ

```bash
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: my-container
      image: my-image
      readinessProbe:
        tcpSocket:
          port: 8080
        initialDelaySeconds: 5
        periodSeconds: 10

```

ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” 5ì´ˆ í›„ë¶€í„° ì»¨í…Œì´ë„ˆì˜ 8080 í¬íŠ¸ë¡œ TCP ì†Œì¼“ ì—°ê²°ì„ í™•ì¸í•˜ê³ , 10ì´ˆë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ Probeë¥¼ ìˆ˜í–‰

### Startup probe

- ì»¨í…Œì´ë„ˆ ë‚´ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ **ì‹œì‘ë˜ì—ˆëŠ”ì§€**ë¥¼ ë‚˜íƒ€ëƒ„
- ì„±ê³µí•  ë•Œ ê¹Œì§€ ë‹¤ë¥¸ **ë‚˜ë¨¸ì§€ probeëŠ” í™œì„±í™” ë˜ì§€ ì•ŠìŒ**
- ì‹¤íŒ¨í•˜ë©´, kubeletì´ ì»¨í…Œì´ë„ˆë¥¼ **ì£½ì´ê³ ** ì»¨í…Œì´ë„ˆëŠ” ì¬ì‹œì‘ **ì •ì±…ì— ë”°ë¼ ì²˜ë¦¬**
- Startup Probeë„ Podì˜Â `spec`Â ì„¹ì…˜ì— ì •ì˜ë˜ë©°,Â `initialDelaySeconds`,Â `periodSeconds`,Â `timeoutSeconds`,Â `failureThreshold`Â ë“±ì˜ ì˜µì…˜ì„ ì„¤ì •í•˜ì—¬ Probeì˜ ë™ì‘ì„ ì¡°ì •í•  ìˆ˜ ìˆìŒ

```bash
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: my-container
      image: my-image
      startupProbe:
        tcpSocket:
          port: 8080
        failureThreshold: 30
        periodSeconds: 10
```

ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” 8080 í¬íŠ¸ë¡œ TCP ì†Œì¼“ ì—°ê²°ì„ ê¸°ë‹¤ë¦¬ë©°, 10ì´ˆë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ Probeë¥¼ ìˆ˜í–‰. ë§Œì•½ 30ë²ˆì˜ ì—°ì† ì‹¤íŒ¨ê°€ ë°œìƒí•˜ë©´ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ì´ ì‹¤íŒ¨ë¡œ ê°„ì£¼

---

## Probe ì‚¬ìš© ë°©ì•ˆ

### Liveness probe

- ì‚¬ì‹¤ ì»¨í…Œì´ë„ˆ ì† í”„ë¡œì„¸ìŠ¤ê°€ ì–´ë– í•œ ì´ìŠˆì— ì§ë©´í•˜ê±°ë‚˜ unhealty ìƒíƒœê°€ ë˜ì–´ í”„ë¡œì„¸ìŠ¤ê°€ ì¤‘ë‹¨ëœë‹¤ë©´ ì›ë˜ëŠ” kubeletì´ íŒŒë“œì˜ restartPolicyì— ë”°ë¼ì„œ ì˜¬ë°”ë¥¸ ëŒ€ì²˜ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜í–‰
- ì´ì™€ ê°™ì€ ê²½ìš°ì—ëŠ” Liveness Probeë¥¼ ì„¤ì •í•œë‹¤ê³  í•´ì„œ í° íš¨ê³¼ëŠ” ì—†ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°ë“œë½ ìƒíƒœì— ë¨¸ë¬´ë¥´ëŠ” ê²ƒì„ ê°ì§€í•˜ì—¬ ì¬ì‹œì‘ì‹œí‚¬ ë•Œ ìœ ìš©í•¨

### Readiness probe

- probeê°€ ì„±ê³µí•œ ê²½ìš°ì—ë§Œ íŒŒë“œì— íŠ¸ë˜í”½ ì „ì†¡ì„ ì‹œì‘í•˜ë ¤ê³  í•œë‹¤ë©´ Readiness probeë¥¼ ì§€ì •í•˜ë©´ ë¨. ì™œëƒí•˜ë©´ ê·¸ì „ê¹Œì§€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¡œë“œë˜ì§€ ì•Šì€ ìƒí™©ì—ì„œë„ íŠ¸ë˜í”½ì´ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë¼ìš°íŒ…ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì„
- í˜¹ì€ ì»¨í…Œì´ë„ˆì˜ ì§€ì†ì ì¸ ìœ ì§€ ë° ê´€ë¦¬ë¥¼ ìœ„í•´ì„œ ìì²´ì ìœ¼ë¡œ ì¤‘ë‹¨ì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°ëŠ” podë¥¼ ì£½ì´ëŠ” Liveness probeë§ê³  Readiness probeë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### Startup probe

- ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ë° ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦¬ê±°ë‚˜ ë¶ˆê·œì¹™ì ì¸ ì»¨í…Œì´ë„ˆì— ì„¤ì •í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŒ
- Startup probeê°€ ì„±ê³µí•˜ê³  ë‚˜ì„œ Liveness, Readiness probeê°€ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ê¸°ë™ì‹œê°„ì´ ë¶ˆê·œì¹™ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ Liveness probeì— ì˜í•´ ê¸°ë™ë˜ê¸°ë„ ì „ì— ì¬ì‹œì‘ ë˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŒ. (Readiness probeë‘ ë¹„ìŠ·í•˜ì§€ë§Œ ë°©ê¸ˆ ë§í•œ ë¶€ë¶„ì€ Readiness probeë¡œ í•´ê²°í•˜ê¸° ì–´ë ¤ì›€)
### ğŸ“ì˜¤ëŠ˜ì˜ íšŒê³ 
- k8s ë³µìŠµì„ ì•ˆí•˜ë‹¤ê°€ ê°‘ìê¸° í•˜ë ¤ë‹ˆ ìµìˆ™ì¹˜ ì•Šì•˜ëŠ”ë° ì˜¤ëŠ˜ ë§ì´ ë§Œì ¸ë³´ë©´ì„œ ëª…ë ¹ì–´ì— ìµìˆ™í•´ì¡ŒìŒ
- ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµì— ëŒ€í•´ ê°œë…ë§Œ ì•Œê³  ìˆì—ˆëŠ”ë° ì˜ˆì œë¥¼ ë”°ë¼í•˜ë©° ì²´ë“í•  ìˆ˜ ìˆì—ˆìŒ

### ğŸ”—ì°¸ê³  ìë£Œ ë° ë§í¬
- [k8s ë¡¤ë§ ë°°í¬](https://ooeunz.tistory.com/124)
- [ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµ](https://simsim231.tistory.com/285)
- [ë¬´ì¤‘ë‹¨ ë°°í¬ ì•„í‚¤í…ì²˜ì™€ ë°°í¬ ì „ëµ](https://hudi.blog/zero-downtime-deployment/)
- [k8s ì‹¤ìŠµ - ë¸”ë£¨ ê·¸ë¦° ë°°í¬](https://velog.io/@synoti21/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EC%8B%A4%EC%8A%B5-Blue-Green-%EB%B0%B0%ED%8F%AC)
- [k8s ì‹¤ìŠµ - ì¹´ë‚˜ë¦¬ ë°°í¬](https://www.youtube.com/watch?v=u588KXtBoKU&t=34s)
- [Probe ì¢…ë¥˜(Liveness, Readiness, Startup)](https://velog.io/@hoonki/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-Probe)
- [Probe ì¢…ë¥˜(Liveness, Readiness, Startup)](https://velog.io/@gun_123/Liveness-Probe-Readiness-Probe-Startup-Probe-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EC%83%81%ED%83%9C-%EC%B2%B4%ED%81%AC%EB%A5%BC-%EC%9C%84%ED%95%9C-Kubernetes-Probe)
- [Liveness Probe vs Readiness Probe](https://cloudest.oopy.io/posting/097#4e9ac802-52b8-49db-8bad-061e356f8e40)